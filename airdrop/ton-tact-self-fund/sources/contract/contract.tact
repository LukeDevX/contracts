import "./jetton";

struct EntData {
    total_supply: Int as coins;
    mintable: Bool; // æ˜¯å¦å¯ä»¥é“¸å¸  true -1 false 0
    max_supply: Int as coins;
}

message Mint {
    amount: Int; // æ•°é‡
    receiver: Address; // æ¥æ”¶è€…åœ°å€
}

contract SampleJetton with Jetton {
    total_supply: Int as coins;
    owner: Address;
    content: Cell;
    mintable: Bool;
    // é¢å¤–è®¾ç½®çš„æœ€å¤§ä¾›åº”é‡
    max_supply: Int as coins; // Extract parameter we set here. The Jetton Standards doesn't have this parameter.
    init(owner: Address, content: Cell, max_supply: Int){
        self.total_supply = 0;
        self.owner = owner;
        self.mintable = true;
        self.content = content;
        self.max_supply = max_supply;
    }

    // åˆçº¦æ‰€æœ‰è€…é“¸å¸
    receive(msg: Mint){
        // 0xfc708bd2
        let ctx: Context = context();
        require(ctx.sender == self.owner, "Not owner"); // åˆ¤æ–­åˆçº¦æ‰€æœ‰è€…æ‰èƒ½è°ƒç”¨è¿™ä¸ªæ¶ˆæ¯
        require(self.mintable, "Not mintable"); // åˆ¤æ–­æ˜¯å¦å¯é“¸å¸
        require((self.total_supply + msg.amount) <= self.max_supply, "Max supply exceeded"); // æ€»ä¾›åº”é‡+å½“å‰ä¾›åº”é‡ æ˜¯å¦ è¶…è¿‡æœ€å¤§ä¾›åº”é‡
        self.mint(msg.receiver, msg.amount, self.owner); // (to, amount, response_destination) // è°ƒç”¨æ–¹æ³•è¿›è¡Œé“¸å¸
    }


    //æ‰€æœ‰äººå‘æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥é“¸100å¸
    // receive("Mint: 100") { // Public Minting
    //     let ctx: Context = context();
    //     require(self.mintable, "Not mintable");
    //     require(self.total_supply + 100 <= self.max_supply, "Max supply exceeded");
    //     self.mint(ctx.sender, 100, self.owner); // ğŸ”´
    // }

     
   
    // å‘é€åˆçº¦ä¸­å‰©ä½™  TON æ‰€æœ‰ä½™é¢ï¼ˆæˆ–éƒ¨åˆ†ä½™é¢ï¼‰
    // https://docs.tact-lang.org/book/message-mode




    // å…³é—­é“¸å¸åï¼Œä»»ä½•äººéƒ½æ— æ³•é“¸å¸
    receive("Owner: MintClose"){
        let ctx: Context = context();
        require(ctx.sender == self.owner, "Not owner"); // åˆ¤æ–­åˆçº¦æ‰€æœ‰è€…æ‰èƒ½è°ƒç”¨è¿™ä¸ªæ¶ˆæ¯
        self.mintable = false;
         send(SendParameters{
                to: ctx.sender, // å‘æ¶ˆæ¯çš„åœ°å€
                value: 0,
                mode: SendRemainingValue, // è¿”å›å‰©ä½™gas
                bounce: false // messages æ²¡æœ‰æˆåŠŸæ‰§è¡Œï¼Œæ˜¯å¦é€€å›ç»™å‘é€è€…ã€‚å‘é€è€…æ¥æ”¶åˆ°åï¼Œå¯ä»¥æ‰§è¡Œæ¢å¤çŠ¶æ€ç­‰æ“ä½œ
            });
        
    }

    // è·å–å½“å‰ jetton æ•°æ®
    get fun get_jetton_info(): EntData {
        return
            EntData{
                total_supply: self.total_supply,
                mintable: self.mintable, // é“¸å¸å¼€å…³
                max_supply: self.max_supply
            };
    }



    
}

// 0QDiUISMHHfjHjqFgGAhT9d9OpPO5puVewBSXKCwzpG3l57p
// base64 te6cckEBAQEAJAAAQ4AcShCRg478Y8dQsAwEKfrvp1J53NNyr2AKS5QWGdI28vDDuwGQ
// boc x{801C4A1091838EFC63C750B00C0429FAEFA75279DCD372AF600A4B941619D236F2F_}
// address EQDiUISMHHfjHjqFgGAhT9d9OpPO5puVewBSXKCwzpG3l3im


// int -1
// coins -0.000000001
// hex -1
// base64 /w==